(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();class F{body;box;direction;baseColor;constructor(e,i){this.box=e,this.direction="",this.baseColor=i,this.body=[{x:9*e,y:10*e}]}setDirection(e){this.direction=e}move(){this.body.pop()}updatePosition(){let e={...this.body[0]};this.direction==="LEFT"&&(e.x-=this.box),this.direction==="UP"&&(e.y-=this.box),this.direction==="RIGHT"&&(e.x+=this.box),this.direction==="DOWN"&&(e.y+=this.box),this.body.unshift(e)}eat(e){return this.updatePosition(),this.body[0].x===e.x&&this.body[0].y===e.y}checkCollision(e,i){let t=this.body[0];if(t.y<this.box*2||t.y>=i||t.x<0||t.x>=e)return!0;for(let o=1;o<this.body.length;o++)if(t.x===this.body[o].x&&t.y===this.body[o].y)return!0;return!1}draw(e){this.body.forEach((i,t)=>{const o=this.getGradientColor(t);e.fillStyle=o,e.fillRect(i.x,i.y,this.box,this.box),e.strokeStyle="#fff",e.strokeRect(i.x,i.y,this.box,this.box),t===0&&(e.fillStyle="#fff",e.beginPath(),e.arc(i.x+this.box/4,i.y+this.box/4,3,0,Math.PI*2),e.arc(i.x+3*this.box/4,i.y+this.box/4,3,0,Math.PI*2),e.fill())})}getGradientColor(e){let i=e/this.body.length,t=this.hexToRgb(this.baseColor);if(!t)return this.baseColor;let o=Math.min(255,Math.floor(t.r+(255-t.r)*i)),s=Math.min(255,Math.floor(t.g+(255-t.g)*i)),l=Math.min(255,Math.floor(t.b+(255-t.b)*i));return`rgb(${o},${s},${l})`}hexToRgb(e){if(e=e.replace("#",""),e.length===3&&(e=e.split("").map(t=>t+t).join("")),e.length!==6)return null;const i=parseInt(e,16);return{r:i>>16&255,g:i>>8&255,b:i&255}}}class C{x=0;y=0;box;sprite;spriteIndex;constructor(e,i,t){this.box=e,this.spriteIndex=i,this.sprite=t,this.reposition([])}reposition(e){let i=!1;for(;!i;)this.x=Math.floor(Math.random()*17+1)*this.box,this.y=Math.floor(Math.random()*15+3)*this.box,i=!e.some(t=>t.x===this.x&&t.y===this.y)}draw(e){const i=this.spriteIndex*138;this.sprite.complete&&e.drawImage(this.sprite,i,0,138,138,this.x,this.y,this.box,this.box)}}class B{sounds;enabled;constructor(){this.enabled=!0,this.sounds={dead:new Audio("./assets/audio/dead.mp3"),eat:new Audio("./assets/audio/eat.mp3"),up:new Audio("./assets/audio/up.mp3"),right:new Audio("./assets/audio/right.mp3"),left:new Audio("./assets/audio/left.mp3"),down:new Audio("./assets/audio/down.mp3")}}play(e){this.enabled&&this.sounds[e]&&this.sounds[e].play()}toggle(){this.enabled=!this.enabled}}class M{constructor(e,i){document.addEventListener("keydown",s=>{s.keyCode===37&&e.direction!=="RIGHT"?(e.setDirection("LEFT"),i.play("left")):s.keyCode===38&&e.direction!=="DOWN"?(e.setDirection("UP"),i.play("up")):s.keyCode===39&&e.direction!=="LEFT"?(e.setDirection("RIGHT"),i.play("right")):s.keyCode===40&&e.direction!=="UP"&&(e.setDirection("DOWN"),i.play("down"))});let t=0,o=0;document.addEventListener("touchstart",s=>{t=s.touches[0].clientX,o=s.touches[0].clientY}),document.addEventListener("touchend",s=>{const l=s.changedTouches[0].clientX,g=s.changedTouches[0].clientY,E=l-t,v=g-o;Math.abs(E)>Math.abs(v)?E>0&&e.direction!=="LEFT"?e.setDirection("RIGHT"):E<0&&e.direction!=="RIGHT"&&e.setDirection("LEFT"):v>0&&e.direction!=="UP"?e.setDirection("DOWN"):v<0&&e.direction!=="DOWN"&&e.setDirection("UP")})}}function T(n,e,i,t){const o=["#AAD750","#A2D148"];for(let s=0;s<i;s+=t)for(let l=0;l<e;l+=t){const g=(l/t+s/t)%2;n.fillStyle=o[g],n.fillRect(l,s,t,t)}}function x(n,e,i,t,o,s){n.fillStyle="#436b2d",n.fillRect(0,0,s,o*2),n.drawImage(e,i*138,0,138,128,o/2,o/2.5,o,o),n.fillText(`${t}`,1.5*o,o),n.fillStyle="#fff",n.font="24px Fredoka",n.textBaseline="middle",n.fillText(`${t}`,1.7*o,o)}const c=document.getElementById("snake"),u=c.getContext("2d"),p=32;let I=0,d=!1,f="",m=0,r,y,a=new B,h;const b=new Image;b.src="./assets/fruit_types.png";b.onload=()=>{w(),document.getElementById("start-btn").addEventListener("click",L)};function w(){document.querySelectorAll("#color-choices .color-choice").forEach(n=>{n.addEventListener("click",()=>{document.querySelectorAll(".color-choice").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),f=n.dataset.color})}),document.querySelectorAll("#fruit-choices .fruit-choice").forEach(n=>{n.addEventListener("click",()=>{document.querySelectorAll(".fruit-choice").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),m=parseInt(n.dataset.index,10)})})}function L(){if(!f){const n=["#ECD718","#3CC746","#B84DF2","#F6F6F6","#1BD9E6","#4F76F9"];f=n[Math.floor(Math.random()*n.length)]}document.querySelector(".fruit-choice.selected")||(m=Math.floor(Math.random()*14)),I=0,r=new F(p,f),r.setDirection("RIGHT"),y=new C(p,m,b),new M(r,a),d=!0,document.getElementById("overlay").classList.remove("visible"),clearInterval(h),h=window.setInterval(D,200)}function D(){T(u,c.width,c.height,p),x(u,b,m,I,p,c.width),r.draw(u),y.draw(u),r.eat(y)?(I++,a.play("eat"),y.reposition(r.body)):r.move(),r.checkCollision(c.width,c.height)&&(a.play("dead"),clearInterval(h),d=!1,A())}function A(){const n=document.getElementById("overlay");n.classList.add("visible"),n.innerHTML=`
    <div class="modal">
      <h1>GAME OVER</h1>
      <p>Elige tu fruta:</p>
      <div class="choices" id="fruit-choices">
        ${Array.from({length:14},(e,i)=>`<span class="fruit-choice" data-index="${i}"></span>`).join("")}
      </div>
      <p>Elige color de la snake:</p>
      <div class="choices" id="color-choices">
        <span class="color-choice" data-color="#ECD718" style="background:#ECD718"></span>
        <span class="color-choice" data-color="#3CC746" style="background:#3CC746"></span>
        <span class="color-choice" data-color="#B84DF2" style="background:#B84DF2"></span>
        <span class="color-choice" data-color="#F6F6F6" style="background:#F6F6F6"></span>
        <span class="color-choice" data-color="#1BD9E6" style="background:#1BD9E6"></span>
        <span class="color-choice" data-color="#4F76F9" style="background:#4F76F9"></span>
      </div>
      <button id="start-btn">‚ñ∂ Play Again</button>
    </div>
  `,w(),document.getElementById("start-btn").addEventListener("click",L)}document.getElementById("btn-up")?.addEventListener("click",()=>{r.direction!=="DOWN"&&r.setDirection("UP")});document.getElementById("btn-down")?.addEventListener("click",()=>{r.direction!=="UP"&&r.setDirection("DOWN")});document.getElementById("btn-left")?.addEventListener("click",()=>{r.direction!=="RIGHT"&&r.setDirection("LEFT")});document.getElementById("btn-right")?.addEventListener("click",()=>{r.direction!=="LEFT"&&r.setDirection("RIGHT")});document.getElementById("audio-btn")?.addEventListener("click",()=>{a.toggle(),document.getElementById("audio-btn").textContent=a.enabled?"üîä":"üîá"});document.getElementById("pause-btn")?.addEventListener("click",P);function P(){d?(clearInterval(h),document.getElementById("pause-btn").textContent="‚ñ∂"):(h=window.setInterval(D,200),document.getElementById("pause-btn").textContent="‚è∏"),d=!d}
